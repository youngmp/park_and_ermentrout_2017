#include <math.h>
#define pi 3.14159265358979323
get2d(double *in,double *out,int nin,int nout, double *var, double *con)
{
  double a0=in[0],a10=in[1],a01=in[2],b10=in[3],b01=in[4],a11=in[5];
  double b11=in[6],c11=in[7],d11=in[8],r=in[9],theta=in[10];
  int n=64;
  double p0=0,p10=0,p01=0,q10=0,q01=0,p11=0,q11=0,r11=0,s11=0;
  double cx,cy,sx,sy,u,f,cxy,sxy,sxcy,sycx;
  double dx=pi/n,dx2=dx*dx;

  int i,j;

  double c[] = {-1.0 , -0.998795456205 , -0.995184726672 , -0.989176509965 , -0.980785280403 , -0.970031253195 , -0.956940335732 , -0.941544065183 , -0.923879532511 , -0.903989293123 , -0.881921264348 , -0.85772861 , -0.831469612303 , -0.803207531481 , -0.773010453363 , -0.740951125355 , -0.707106781187 , -0.671558954847 , -0.634393284164 , -0.595699304492 , -0.55557023302 , -0.514102744193 , -0.471396736826 , -0.42755509343 , -0.382683432365 , -0.336889853392 , -0.290284677254 , -0.242980179903 , -0.195090322016 , -0.146730474455 , -0.0980171403296 , -0.0490676743274 , 6.12323399574e-17 , 0.0490676743274 , 0.0980171403296 , 0.146730474455 , 0.195090322016 , 0.242980179903 , 0.290284677254 , 0.336889853392 , 0.382683432365 , 0.42755509343 , 0.471396736826 , 0.514102744193 , 0.55557023302 , 0.595699304492 , 0.634393284164 , 0.671558954847 , 0.707106781187 , 0.740951125355 , 0.773010453363 , 0.803207531481 , 0.831469612303 , 0.85772861 , 0.881921264348 , 0.903989293123 , 0.923879532511 , 0.941544065183 , 0.956940335732 , 0.970031253195 , 0.980785280403 , 0.989176509965 , 0.995184726672 , 0.998795456205 , 1.0 , 0.998795456205 , 0.995184726672 , 0.989176509965 , 0.980785280403 , 0.970031253195 , 0.956940335732 , 0.941544065183 , 0.923879532511 , 0.903989293123 , 0.881921264348 , 0.85772861 , 0.831469612303 , 0.803207531481 , 0.773010453363 , 0.740951125355 , 0.707106781187 , 0.671558954847 , 0.634393284164 , 0.595699304492 , 0.55557023302 , 0.514102744193 , 0.471396736826 , 0.42755509343 , 0.382683432365 , 0.336889853392 , 0.290284677254 , 0.242980179903 , 0.195090322016 , 0.146730474455 , 0.0980171403296 , 0.0490676743274 , 6.12323399574e-17 , -0.0490676743274 , -0.0980171403296 , -0.146730474455 , -0.195090322016 , -0.242980179903 , -0.290284677254 , -0.336889853392 , -0.382683432365 , -0.42755509343 , -0.471396736826 , -0.514102744193 , -0.55557023302 , -0.595699304492 , -0.634393284164 , -0.671558954847 , -0.707106781187 , -0.740951125355 , -0.773010453363 , -0.803207531481 , -0.831469612303 , -0.85772861 , -0.881921264348 , -0.903989293123 , -0.923879532511 , -0.941544065183 , -0.956940335732 , -0.970031253195 , -0.980785280403 , -0.989176509965 , -0.995184726672 , -0.998795456205};

  double s[] = {-1.22464679915e-16 , -0.0490676743274 , -0.0980171403296 , -0.146730474455 , -0.195090322016 , -0.242980179903 , -0.290284677254 , -0.336889853392 , -0.382683432365 , -0.42755509343 , -0.471396736826 , -0.514102744193 , -0.55557023302 , -0.595699304492 , -0.634393284164 , -0.671558954847 , -0.707106781187 , -0.740951125355 , -0.773010453363 , -0.803207531481 , -0.831469612303 , -0.85772861 , -0.881921264348 , -0.903989293123 , -0.923879532511 , -0.941544065183 , -0.956940335732 , -0.970031253195 , -0.980785280403 , -0.989176509965 , -0.995184726672 , -0.998795456205 , -1.0 , -0.998795456205 , -0.995184726672 , -0.989176509965 , -0.980785280403 , -0.970031253195 , -0.956940335732 , -0.941544065183 , -0.923879532511 , -0.903989293123 , -0.881921264348 , -0.85772861 , -0.831469612303 , -0.803207531481 , -0.773010453363 , -0.740951125355 , -0.707106781187 , -0.671558954847 , -0.634393284164 , -0.595699304492 , -0.55557023302 , -0.514102744193 , -0.471396736826 , -0.42755509343 , -0.382683432365 , -0.336889853392 , -0.290284677254 , -0.242980179903 , -0.195090322016 , -0.146730474455 , -0.0980171403296 , -0.0490676743274 , 0.0 , 0.0490676743274 , 0.0980171403296 , 0.146730474455 , 0.195090322016 , 0.242980179903 , 0.290284677254 , 0.336889853392 , 0.382683432365 , 0.42755509343 , 0.471396736826 , 0.514102744193 , 0.55557023302 , 0.595699304492 , 0.634393284164 , 0.671558954847 , 0.707106781187 , 0.740951125355 , 0.773010453363 , 0.803207531481 , 0.831469612303 , 0.85772861 , 0.881921264348 , 0.903989293123 , 0.923879532511 , 0.941544065183 , 0.956940335732 , 0.970031253195 , 0.980785280403 , 0.989176509965 , 0.995184726672 , 0.998795456205 , 1.0 , 0.998795456205 , 0.995184726672 , 0.989176509965 , 0.980785280403 , 0.970031253195 , 0.956940335732 , 0.941544065183 , 0.923879532511 , 0.903989293123 , 0.881921264348 , 0.85772861 , 0.831469612303 , 0.803207531481 , 0.773010453363 , 0.740951125355 , 0.707106781187 , 0.671558954847 , 0.634393284164 , 0.595699304492 , 0.55557023302 , 0.514102744193 , 0.471396736826 , 0.42755509343 , 0.382683432365 , 0.336889853392 , 0.290284677254 , 0.242980179903 , 0.195090322016 , 0.146730474455 , 0.0980171403296 , 0.0490676743274 };


  /*   printf("%d %g %g %g %g %g %g \n",n,a0,a10,a01,a11,r,theta); */
  for(i=-n;i<n;i++){
      cy=c[i+n];
      sy=s[i+n];
    for(j=-n;j<n;j++){
      cx=c[j+n];
      sx=s[j+n];

      cxy=cx*cy;
      sxy=sx*sy;
      sxcy=sx*cy;
      sycx=sy*cx;


      u=a0+a10*cx+a01*cy+a11*cxy+b10*sx+b01*sy+b11*sxy+c11*sxcy+d11*sycx;
      f=1/(1+exp(-r*(u-theta)));
      p0+=f; /* a0 */
      p10+=(cx*f); /* a10 */
      p01+=(cy*f); /* a01 */
      p11+=(cxy*f); /* a11 */
      q10+=(sx*f); /* b10 */
      q01+=(sy*f); /* b01 */
      q11+=(sxy*f); /* b11 */
      r11+=(sxcy*f); /* c11 */
      s11+=(sycx*f); /* d11 */
   
    }
  }
  out[0]=p0*dx2; /* a0 */
  out[1]=p10*dx2; /* a10 */
  out[2]=p01*dx2;
  out[3]=q10*dx2;
  out[4]=q01*dx2;
  out[5]=p11*dx2;
  out[6]=q11*dx2;
  out[7]=r11*dx2;
  out[8]=s11*dx2;
 

}

	
  
  
